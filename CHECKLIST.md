# üöÄ Deployment Checklist

## –ü–µ—Ä–µ–¥ –ª–æ–∫–∞–ª—å–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º

- [ ] Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –°–æ–∑–¥–∞–Ω –±–æ—Ç –≤ @BotFather –∏ –ø–æ–ª—É—á–µ–Ω —Ç–æ–∫–µ–Ω
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω `.env.example` –≤ `.env`
- [ ] –í `.env` —É–∫–∞–∑–∞–Ω BOT_TOKEN
- [ ] –í `.env` —É–∫–∞–∑–∞–Ω DB_PASSWORD
- [ ] –ó–∞–ø—É—â–µ–Ω `start.bat` (Windows) –∏–ª–∏ `start.sh` (Linux/Mac)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏: `docker compose logs -f bot`
- [ ] –û—Ç–ø—Ä–∞–≤–ª–µ–Ω `/start` –±–æ—Ç—É –≤ –ª–∏—á–∫—É
- [ ] –î–æ–±–∞–≤–ª–µ–Ω –±–æ—Ç –≤ —Ç–µ—Å—Ç–æ–≤—É—é –≥—Ä—É–ø–ø—É
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/startgame`

## –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### GitHub –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
- [ ] –°–æ–∑–¥–∞–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
- [ ] –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–¥–µ–ª–∞–Ω –ø—É–±–ª–∏—á–Ω—ã–º (–∏–ª–∏ GHCR_PAT –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É)
- [ ] –ó–∞–ø—É—à–µ–Ω –∫–æ–¥: `git push origin main`
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã GitHub Secrets:
  - [ ] `SERVER_HOST` - IP —Å–µ—Ä–≤–µ—Ä–∞
  - [ ] `SERVER_USER` - –æ–±—ã—á–Ω–æ `root`
  - [ ] `SSH_PRIVATE_KEY` - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á
  - [ ] `BOT_TOKEN` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
  - [ ] `DB_PASSWORD` - –ø–∞—Ä–æ–ª—å –¥–ª—è PostgreSQL
  - [ ] `GHCR_PAT` - GitHub Personal Access Token —Å –ø—Ä–∞–≤–∞–º–∏ `write:packages`

### –°–µ—Ä–≤–µ—Ä –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
- [ ] Ubuntu/Debian —Å–µ—Ä–≤–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Docker —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `curl -fsSL https://get.docker.com | sh`
- [ ] Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–æ–±—ã—á–Ω–æ –∏–¥—ë—Ç —Å Docker)
- [ ] –û—Ç–∫—Ä—ã—Ç—ã –ø–æ—Ä—Ç—ã (–µ—Å–ª–∏ firewall):
  ```bash
  # –î–ª—è SSH
  ufw allow 22
  # –î–ª—è Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∏—Å—Ö–æ–¥—è—â–∏–µ –æ–±—ã—á–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã)
  ufw allow out 443
  ```
- [ ] –°–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: `mkdir -p /root/spy-game`
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω SSH –¥–æ—Å—Ç—É–ø –ø–æ –∫–ª—é—á—É

### –î–µ–ø–ª–æ–π
- [ ] –°–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
  ```bash
  cd /root/spy-game
  git clone <your-repo-url> .
  ```
- [ ] –°–¥–µ–ª–∞–Ω push –≤ `main` –≤–µ—Ç–∫—É (–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è GitHub Action)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω —Å—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ—è –≤ GitHub Actions
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
  ```bash
  cd /root/spy-game
  docker compose logs -f bot
  ```

## –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

- [ ] –û—Ç–ø—Ä–∞–≤–ª–µ–Ω `/start` –±–æ—Ç—É
- [ ] –î–æ–±–∞–≤–ª–µ–Ω –±–æ—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–Ω –≥—Ä—É–ø–ø—É
- [ ] –°–¥–µ–ª–∞–Ω –∞–¥–º–∏–Ω–æ–º –≥—Ä—É–ø–ø—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã:
  - [ ] `/help`
  - [ ] `/settings`
  - [ ] `/startgame`
  - [ ] `/endregister` (—Å –º–∏–Ω–∏–º—É–º 4 –∏–≥—Ä–æ–∫–∞–º–∏)
  - [ ] `/next`
  - [ ] `/endgame`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –≤ –≥—Ä—É–ø–ø–µ –¥—Ä—É–≥–æ–π —è–∑—ã–∫)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–£–∑–Ω–∞—Ç—å —Ä–æ–ª—å"
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ä–æ–ª—è–º–∏

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤:
  ```bash
  docker compose logs -f bot
  ```
- [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ:
  ```bash
  df -h
  ```
- [ ] –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
  ```bash
  docker compose ps
  ```

## –ë—ç–∫–∞–ø—ã

- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π –±—ç–∫–∞–ø –ë–î:
  ```bash
  # –î–æ–±–∞–≤–∏—Ç—å –≤ crontab
  0 2 * * * cd /root/spy-game && docker compose exec -T postgres pg_dump -U postgres spy_game | gzip > /root/backups/spy_$(date +\%Y\%m\%d).sql.gz
  ```
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω –ø–µ—Ä–≤—ã–π –±—ç–∫–∞–ø
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

## –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞ –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```bash
cd /root/spy-game
git pull origin main
docker compose down
docker compose build --no-cache
docker compose up -d
docker compose logs -f bot
```

–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—à–∏—Ç—å –≤ `main` - GitHub Actions –≤—Å—ë —Å–¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## Troubleshooting

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
   ```bash
   docker compose logs bot
   docker compose logs postgres
   ```

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å:**
   ```bash
   docker compose restart bot
   ```

3. **–ü–æ–ª–Ω—ã–π —Ä–µ—Å—Ç–∞—Ä—Ç:**
   ```bash
   docker compose down
   docker compose up -d
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î:**
   ```bash
   docker compose exec bot python -c "from app.database.database import async_session_maker; import asyncio; asyncio.run(async_session_maker().__aenter__())"
   ```

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞:**
   ```bash
   docker compose exec bot python -c "from app.config import settings; print(settings.BOT_TOKEN)"
   ```

## –ì–æ—Ç–æ–≤–æ! üéâ

–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –∏–≥—Ä–æ–π!
