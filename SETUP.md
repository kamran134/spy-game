# Spy Game Bot - Setup Guide

## üöÄ Quick Start (–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

### 1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <your-repo-url>
cd spy-game

# –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` –∏ –¥–æ–±–∞–≤—å—Ç–µ:
- `BOT_TOKEN` - –≤–∞—à —Ç–æ–∫–µ–Ω –æ—Ç BotFather
- `DB_PASSWORD` - –ø–∞—Ä–æ–ª—å –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–ª—é–±–æ–π)

### 3. –ó–∞–ø—É—Å–∫

**Windows:**
```bash
start.bat
```

**Linux/Mac:**
```bash
chmod +x start.sh
./start.sh
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
```bash
docker compose up -d
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
docker compose logs -f bot
```

### 5. –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
docker compose down
```

---

## üåê –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä (Production)

### 1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
mkdir -p /root/spy-game
cd /root/spy-game

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <your-repo-url> .
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å GitHub Secrets

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (Settings ‚Üí Secrets and variables ‚Üí Actions) –¥–æ–±–∞–≤—å—Ç–µ:

- `SERVER_HOST` - IP –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- `SERVER_USER` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—ã—á–Ω–æ `root`)
- `SSH_PRIVATE_KEY` - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `BOT_TOKEN` - —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
- `DB_PASSWORD` - –ø–∞—Ä–æ–ª—å –¥–ª—è PostgreSQL
- `GHCR_PAT` - GitHub Personal Access Token –¥–ª—è Container Registry
  - –°–æ–∑–¥–∞–π—Ç–µ –Ω–∞ GitHub: Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Tokens (classic)
  - –í—ã–±–µ—Ä–∏—Ç–µ: `write:packages`, `read:packages`, `delete:packages`

### 3. –î–µ–ø–ª–æ–π

–ü–æ—Å–ª–µ –ø—É—à–∞ –≤ `main` –≤–µ—Ç–∫—É, GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –°–æ–±–µ—Ä—ë—Ç Docker –æ–±—Ä–∞–∑ –∏ –∑–∞–ø—É—à–∏—Ç –≤ GitHub Container Registry (GHCR)
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ SSH
3. –û–±–Ω–æ–≤–∏—Ç –∫–æ–¥
4. –°–æ–∑–¥–∞—Å—Ç `.env` –∏ `docker-compose.yml`
5. –°–∫–∞—á–∞–µ—Ç –æ–±—Ä–∞–∑ –∏–∑ GHCR –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
5. –ó–∞–ø–æ–ª–Ω–∏—Ç –±–∞–∑—É –ª–æ–∫–∞—Ü–∏—è–º–∏

---

## üìã –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –î–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- `/start` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ
- `/help` - –ü–æ–º–æ—â—å –ø–æ –∏–≥—Ä–µ

### –î–ª—è –∞–¥–º–∏–Ω–æ–≤ –≥—Ä—É–ø–ø—ã:
- `/settings` - –ü–æ–∫–∞–∑–∞—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  - –§–æ—Ä–º–∞—Ç: `/settings —è–∑—ã–∫ –º–∏–Ω –º–∞–∫—Å –ø—Ä–æ—Ü–µ–Ω—Ç—ã`
  - –ü—Ä–∏–º–µ—Ä: `/settings ru 5 8 25`
  
- `/addlocation` - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é
  - –§–æ—Ä–º–∞—Ç: `/addlocation –†—É—Å—Å–∫–∏–π | English | Az…ôrbaycan`
  - –ü—Ä–∏–º–µ—Ä: `/addlocation –ö–∞—Ñ–µ | Cafe | Kafe`

- `/startgame` - –ù–∞—á–∞—Ç—å –Ω–∞–±–æ—Ä –∏–≥—Ä–æ–∫–æ–≤
- `/endregister` - –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É
- `/next` - –°–ª–µ–¥—É—é—â–∏–π –∏–≥—Ä–æ–∫ (–ø–µ—Ä–µ—Ö–æ–¥ —Ö–æ–¥–∞)
- `/endgame` - –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É

---

## üéÆ –ü—Ä–æ—Ü–µ—Å—Å –∏–≥—Ä—ã

1. **–ê–¥–º–∏–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç** `/startgame`
2. **–ò–≥—Ä–æ–∫–∏ –Ω–∞–∂–∏–º–∞—é—Ç** –∫–Ω–æ–ø–∫—É "–£—á–∞—Å—Ç–≤—É—é" –∏–ª–∏ "–ü–∞—Å"
3. **–ê–¥–º–∏–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç** `/endregister`
4. **–ë–æ—Ç —Ä–∞–∑–¥–∞—ë—Ç —Ä–æ–ª–∏:**
   - –í –≥—Ä—É–ø–ø–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–£–∑–Ω–∞—Ç—å —Ä–æ–ª—å"
   - –í –ª–∏—á–∫—É –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ä–æ–ª–∏ (–µ—Å–ª–∏ –∏–≥—Ä–æ–∫ –ø–∏—Å–∞–ª `/start` –±–æ—Ç—É)
5. **–ò–≥—Ä–æ–∫–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏** –Ω–∞–∑—ã–≤–∞—é—Ç –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏
   - –ê–¥–º–∏–Ω –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ö–æ–¥—ã –∫–æ–º–∞–Ω–¥–æ–π `/next`
6. **–í –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç:**
   - –®–ø–∏–æ–Ω –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å "–Ø —à–ø–∏–æ–Ω!" –∏ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è —É–≥–∞–¥–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é
   - –ò–≥—Ä–æ–∫–∏ –º–æ–≥—É—Ç –Ω–∞–∂–∞—Ç—å "–û–±–≤–∏–Ω–∏—Ç—å –∏–≥—Ä–æ–∫–∞" –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
7. **–ê–¥–º–∏–Ω –∑–∞–≤–µ—Ä—à–∞–µ—Ç** –∏–≥—Ä—É –∫–æ–º–∞–Ω–¥–æ–π `/endgame`

---

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
spy-game/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ bot/              # –õ–æ–≥–∏–∫–∞ –±–æ—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/     # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ keyboards/    # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middlewares/  # Middleware (DB, i18n)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filters/      # –§–∏–ª—å—Ç—Ä—ã (–∞–¥–º–∏–Ω)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/        # –£—Ç–∏–ª–∏—Ç—ã (–∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)
‚îÇ   ‚îú‚îÄ‚îÄ database/         # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py     # –ú–æ–¥–µ–ª–∏ SQLAlchemy
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py   # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repositories/ # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ locales/          # –ü–µ—Ä–µ–≤–æ–¥—ã (ru, en, az)
‚îÇ   ‚îú‚îÄ‚îÄ config.py         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ main.py           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ migrations/           # –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic
‚îú‚îÄ‚îÄ scripts/              # –°–∫—Ä–∏–ø—Ç—ã (–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–π)
‚îú‚îÄ‚îÄ .github/workflows/    # CI/CD
‚îî‚îÄ‚îÄ ...
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ª–æ–∫–∞—Ü–∏–π

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `scripts/populate_locations.py` –∏ –¥–æ–±–∞–≤—å—Ç–µ:

```python
{"ru": "–ù–∞–∑–≤–∞–Ω–∏–µ RU", "en": "Name EN", "az": "Ad AZ"},
```

–ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
docker compose exec bot python scripts/populate_locations.py
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —è–∑—ã–∫–∞

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `app/locales/xx.json` (–≥–¥–µ xx - –∫–æ–¥ —è–∑—ã–∫–∞)
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ `ru.json` –∏ –ø–µ—Ä–µ–≤–µ–¥–∏—Ç–µ
3. –û–±–Ω–æ–≤–∏—Ç–µ `app/bot/middlewares/i18n.py` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤–æ–≥–æ —è–∑—ã–∫–∞

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
docker compose logs -f bot
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
```bash
docker compose exec postgres psql -U postgres -d spy_game
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
```bash
docker compose restart bot
```

### –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```bash
docker compose down
docker compose build --no-cache
docker compose up -d
```

---

## üìù TODO / –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –∑–∞ —à–ø–∏–æ–Ω–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä–æ–∫–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä –Ω–∞ —Ö–æ–¥—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª–∏ (–∫—Ä–æ–º–µ —à–ø–∏–æ–Ω–∞)
- [ ] –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏—è–º–∏ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- [ ] –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –ª–æ–∫–∞—Ü–∏–π –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

---

## üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã, —Å–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
